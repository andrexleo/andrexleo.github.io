<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Graficas Inventario</title>
    <style>
      /* Estilos generales */
      body {
        font-family: "Arial", sans-serif;
        background-color: #ffffff;
        margin: 0;
        padding: 2px;
      }
      .containerSelector {
        /* flex-wrap: nowrap; */
        gap: 5px;
        align-content: center;
        width: 100%;
        position: fixed;
        background-color: white;
        z-index: 100;
        align-self: center;
        padding: 5px;
        top: 0;
        transition: all 0.3s ease;
        box-shadow: 0 7px 35px rgba(0, 0, 0, 0.08);
        border-radius: 10px;
        padding: 10px;
      }

      .itemSelector {
        width: 250px; /* Permite que todos los selects crezcan proporcionalmente */
        min-width: 100px; /* Evita que sean demasiado pequeños */
        padding: 5px 10px;
        font-size: 14px;
        border-radius: 5px;
        border: 1px solid #39aa35;
        background-color: #ffffff;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 7px 35px rgba(0, 0, 0, 0.08);
      }
      .containerSelector6 {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
      }
      .itemSelector6 {
        width: 100px;

        flex-basis: 200;
      }
      #sucursales,
      #categorias,
      #lineas {
        padding: 10px 15px;
        font-size: 16px;
        border-radius: 5px;
        border: 1px solid #39aa35;
        margin-bottom: 5px;
        background-color: #ffffff;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 7px 35px rgba(0, 0, 0, 0.08);
      }
      .cardBox {
        width: 100%;
        display: flex;
        gap: 10px;
        flex-direction: row;
        padding-top: 10px;
        justify-content: space-around;
        align-items: center;
        flex-wrap: wrap;
        padding-bottom: 10px;
      }
      .card {
        width: 250px;
        background: #6f5fd4;

        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        box-shadow: 0 7px 25px rgba(0, 0, 0, 0.08);
        color: #dfd9d9;
        transition: background 0.3s ease;
      }

      .card img {
        width: 50px;
        height: 50px;
        align-self: center;
      }

      .numbers {
        font-weight: 500;
        font-size: 18px;
        color: white;
        text-align: center;
      }

      .cardName {
        font-size: 1.1rem;
        color: rgb(191, 183, 183);
      }

      #tipo_reporte {
        padding: 2px;
        font-size: 16px;
        border-radius: 5px;
        border: 1px solid #39aa35;
        margin-bottom: 5px;
        background-color: #ffffff;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 7px 35px rgba(0, 0, 0, 0.08);
      }
      #chartContainer {
        display: flex;
        flex-direction: row;
        gap: 20px;
        height: 600px;
      }
      #chartContainer1 {
        display: flex;
        flex: content;
        flex-direction: column;
        box-shadow: 0px 2px 10px rgba(0, 0, 0, 0.1);
      }
      #chartContainer2 {
        display: flex;
        flex: content;
        flex-direction: column;
        box-shadow: 0px 2px 10px rgba(0, 0, 0, 0.1);
        margin-top: 20px;
      }
      .chart-title4 {
        font-size: 14px;
      }
      #chartdiv1,
      #chartdiv211,
      #chartdiv3,
      #chartdiv411,
      #chartdiv5 {
        width: 100%;
        height: 600px;
        background-color: #ffffff;
        margin-right: 2px;
        border-radius: 8px;
      }
      #chartdiv,
      #chartdivdonut {
        width: 100%;
        height: 100%;
        margin-bottom: 10px;
        background-color: #ffffff;
        border-radius: 8px;
      }
      .titleContainer1 {
        display: flex;
        flex-direction: row;
        height: 40px;
        padding-left: 5px;
        border-radius: 5px;
        gap: 10px;
      }
      .titleContainer {
        display: flex;
        flex-direction: row;
        gap: 10px;
        height: 40px;
        padding-left: 5px;
        border-radius: 5px;
        align-items: center;
      }
      .box {
        width: 15px;
        height: 30px;
        background-color: #39aa35;
        border-radius: 8px;
        align-self: center;
      }
      .chart-title {
        font-size: 14px;
        font-weight: bold;
        font-family: Arial, "Helvetica Neue", Helvetica, sans-serif;
        text-align: center;
        color: #333333;

        letter-spacing: 1px;
      }
      @media (max-width: 820px) {
        #chartContainer {
          flex-direction: column;
          height: 900px;
        }
        .chartContainer2 {
          height: 100%;
        }
        .itemSelector {
          font-size: 12px;
        }

        .card {
          width: 90%;
        }
      }
    </style>
    <script src="https://cdn.amcharts.com/lib/5/index.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/xy.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/themes/Animated.js"></script>

    <script src="https://cdn.amcharts.com/lib/5/percent.js"></script>
    <!-- Bootstrap CSS -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    />
    <!-- Bootstrap Select CSS -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.14.0-beta2/dist/css/bootstrap-select.min.css"
    />

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Bootstrap Select JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.14.0-beta2/dist/js/bootstrap-select.min.js"></script>
  </head>
  <body>
    <!-- Dropdowns -->
    <div class="containerSelector">
      <div
        class="containerDropdown"
        style="width: 500px; flex-direction: row; flex-wrap: nowrap"
      >
        <select
          class="selectpicker SelectorDropdown show-tick dropup"
          data-width="25%"
          height="10%"
          color="black"
          id="lineas"
        >
          <option value="lineas" selected="true">Línea Producto</option>
        </select>
        <select
          class="selectpicker SelectorDropdown show-tick dropup"
          data-width="25%"
          height="10%"
          color="black"
          id="sucursales"
        >
          <option value="sucursales" selected="true">Sucursal</option>
        </select>
        <select
          class="selectpicker SelectorDropdown show-tick dropup"
          data-width="25%"
          height="10%"
          color="black"
          id="categorias"
          data-live-search="true"
        >
          <option value="categorias" selected="true">Categoría</option>
        </select>
      </div>
    </div>

    <!-- Divs para las cards -->
    <div class="cardBox" style="margin-top: 60px">
      <div class="card" style="background-color: #6f5fd4">
        <img
          width="64"
          height="64"
          src="https://img.icons8.com/external-yogi-aprelliyanto-glyph-yogi-aprelliyanto/64/FFFFFF/external-generator-electric-element-yogi-aprelliyanto-glyph-yogi-aprelliyanto.png"
          alt="external-generator-electric-element-yogi-aprelliyanto-glyph-yogi-aprelliyanto"
        />
        <div>
          <div class="numbers" id="totalEquipos"></div>
          <div class="cardName">Total Equipos</div>
        </div>

        <div class="iconBx">
          <ion-icon name="eye-outline"></ion-icon>
        </div>
      </div>

      <div class="card" style="background-color: #5e8dd4">
        <img
          width="100"
          height="100"
          src="https://img.icons8.com/ios-filled/100/FFFFFF/flag--v1.png"
          alt="flag--v1"
        />
        <div>
          <div class="numbers" id="rentready"></div>
          <div class="cardName">Rent Ready</div>
        </div>

        <div class="iconBx">
          <ion-icon name="cart-outline"></ion-icon>
        </div>
      </div>

      <div class="card" style="background-color: #8c64f7">
        <img
          width="100"
          height="100"
          src="https://img.icons8.com/ios-filled/100/FFFFFF/checked-checkbox.png"
          alt="checked-checkbox"
        />
        <div>
          <div class="numbers" id="onrent"></div>
          <div class="cardName"># On Rent</div>
        </div>

        <div class="iconBx">
          <ion-icon name="chatbubbles-outline"></ion-icon>
        </div>
      </div>

      <div class="card" style="background-color: #8732cd">
        <img
          width="100"
          height="100"
          src="https://img.icons8.com/glyph-neue/100/FFFFFF/percentage.png"
          alt="percentage"
        />
        <div>
          <div class="numbers" id="utilizacion"></div>
          <div class="cardName">Utilización</div>
        </div>

        <div class="iconBx"></div>
      </div>
    </div>

    <!-- Divs para las gráficas -->
    <div id="chartContainer">
      <div id="chartContainer1">
        <div class="titleContainer1">
          <div class="box"></div>
          <h1 class="chart-title">% Activos por Linea</h1>
        </div>
        <div id="chartdiv"></div>
      </div>

      <div id="chartContainer1">
        <div class="titleContainer1">
          <div class="box"></div>
          <h1 class="chart-title">% Utilización</h1>
        </div>
        <div id="chartdivdonut"></div>
      </div>
    </div>
    <div id="chartContainer2">
      <div class="titleContainer">
        <div class="box"></div>
        <h1 class="chart-title">Total Activos</h1>
      </div>
      <div id="chartdiv1"></div>
    </div>
    <div id="chartContainer2">
      <div class="titleContainer">
        <div class="box"></div>
        <h1 class="chart-title">% de Utilización por Sucursal</h1>
      </div>
      <div id="chartdiv211"></div>
    </div>
    <div id="chartContainer2">
      <div class="titleContainer">
        <div class="box"></div>
        <h1 class="chart-title">Estatus Operacional por Sucursal</h1>
      </div>
      <div id="chartdiv3"></div>
    </div>
    <div id="chartContainer2">
      <div class="titleContainer">
        <div class="box"></div>
        <h1 class="chart-title">% Utilización por Propietario</h1>
      </div>
      <div id="chartdiv411"></div>
    </div>
    <div id="chartContainer2">
      <div class="titleContainer">
        <div class="box"></div>
        <h1 class="chart-title">% Utilización por Categoria</h1>
      </div>
      <div id="chartdiv5"></div>
    </div>

    <script>
      // Crear las raíces y gráficos
      var root = am5.Root.new("chartdiv");
      var root6 = am5.Root.new("chartdivdonut");
      var root1 = am5.Root.new("chartdiv1");
      var root2 = am5.Root.new("chartdiv211");
      var root3 = am5.Root.new("chartdiv3");
      var root4 = am5.Root.new("chartdiv411");
      var root5 = am5.Root.new("chartdiv5");

      root.setThemes([am5themes_Animated.new(root)]);
      root6.setThemes([am5themes_Animated.new(root6)]);
      root1.setThemes([am5themes_Animated.new(root1)]);
      root2.setThemes([am5themes_Animated.new(root2)]);
      root3.setThemes([am5themes_Animated.new(root3)]);
      root4.setThemes([am5themes_Animated.new(root4)]);
      root5.setThemes([am5themes_Animated.new(root5)]);
      // Declarar variables globales
      let pieChartData = [];
      let totalData = [];
      let utilizacionData = [];
      let barData = [];
      let dataAlerta = [];
      let datacategoria = [];
      let datacumple = [];
      let ActivosPorLineaData = [];
      let donutData = [];
      let propietarioData = [];
      let categoryData = [];
      let legend10;
      let legend0;
      let series0;
      let series11,
        chart1,
        xAxis1,
        chart3,
        xAxis3,
        chart4,
        xAxis4,
        chart5,
        xAxis5,
        chart6,
        xAxis6,
        cumplimientoAxis,
        legend;

      // Función para actualizar datos
      function setData(
        pieChartData,
        ActivosPorLineaData,
        donutData,
        totalData,
        utilizacionData,
        barData,
        propietarioData,
        categoryData
      ) {
        series1.data.setAll(totalData);
        xAxis1.data.setAll(totalData);
        series2.data.setAll(utilizacionData);
        xAxis2.data.setAll(utilizacionData);
        series4.data.setAll(propietarioData);
        xAxis4.data.setAll(propietarioData);
        series5.data.setAll(categoryData);
        xAxis5.data.setAll(categoryData);

        if (series11 && ActivosPorLineaData && ActivosPorLineaData.length) {
          series11.data.setAll(ActivosPorLineaData);
        }
        if (series0 && donutData && donutData.length) {
          series0.data.setAll(donutData);
        }
        if (chart3 && barData && barData.length) {
          chart3.series.each((series) => series.data.setAll(barData));
          if (xAxis3) xAxis3.data.setAll(barData);
        }
        legend10.data.setAll(series11.dataItems);
        legend0.data.setAll(series0.dataItems);
      }

      // Actualizar valores de las tarjetas
      function updateCards(data) {
        // Actualiza el total de equipos
        const totalEquiposElement = document.getElementById("totalEquipos");
        totalEquiposElement.textContent = data.activos_por_linea.total.subtotal;

        const onRentElement = document.getElementById("onrent");
        onRentElement.textContent =
          data.utilizacion_por_sucursal.total.on_rent || 0;

        // Actualiza el % Rent Ready
        const rentReadyElement = document.getElementById("rentready");
        rentReadyElement.textContent = `${Math.trunc(
          data.estatus_operacional_por_branch.total_porc["Rent Ready"] || 0
        )}%`;

        // Actualiza el % de Utilización
        const utilizacionElement = document.getElementById("utilizacion");
        const onRent = data.utilizacion_por_sucursal.total.on_rent || 0;
        const offRent = data.utilizacion_por_sucursal.total.off_rent || 0;
        const totalEquipos = onRent + offRent;
        const utilizacion =
          totalEquipos > 0 ? Math.round((onRent / totalEquipos) * 100) : 0;
        utilizacionElement.textContent = `${utilizacion}%`;
      }
      //chart3.series.each((series) => series.data.setAll(barData));
      //if (xAxis3) xAxis3.data.setAll(barData);
      //}
      /* if (chart4 && dataAlerta && dataAlerta.length) {
          chart4.series.each((series4) => series4.data.setAll(dataAlerta));
          if (xAxis4) xAxis4.data.setAll(dataAlerta);
        }
        if (chart5 && datacategoria && datacategoria.length) {
          chart5.series.each((series5) => series5.data.setAll(datacategoria));
          if (xAxis5) xAxis5.data.setAll(datacategoria);
        }
        if (chart6 && datacumple && datacumple.length) {
          chart6.series.each((series6) => series6.data.setAll(datacumple));
          if (xAxis6) xAxis6.data.setAll(datacumple);
        }*/
      //legend10.data.setAll(series11.dataItems);
      //}

      // Función para obtener datos de la API principal
      const fetchFilteredData = (
        lineaProducto = "",
        sucursalId = "",
        categoriaId = ""
      ) => {
        const queryParams = new URLSearchParams({
          linea_producto: lineaProducto,
          sucursal_id: sucursalId,
          categoria_id: categoriaId,
        });

        fetch("https://maintenancechart.onrender.com/api/data?" + queryParams)
          .then((response) => response.json())
          .then((data) => {
            console.log("Datos obtenidos de /api/data:", data);

            const abbreviations = {
              "Mantenimiento Mayor": "Mtto. Mayor",
              "Mantenimiento Menor": "Mtto. Menor",
            };

            pieChartData = Object.keys(
              data.estatus_operacional_por_branch.total_porc
            )
              .filter((key) => !["branch", "sucursal", "total"].includes(key))
              .map((key) => ({
                category: abbreviations[key] || key, // Usar abreviación si existe, de lo contrario mantener el nombre original
                value: data.estatus_operacional_por_branch.total_porc[key],
              }));
            console.log("pieChartData", pieChartData);

            barData = Object.keys(data.estatus_operacional_por_branch)
              .filter((key) => !["total_porc", "total"].includes(key))
              .map((key) => ({
                sucursal: data.estatus_operacional_por_branch[key].sucursal,
                minor:
                  data.estatus_operacional_por_branch[key][
                    "Mantenimiento Menor"
                  ] || 0,
                major:
                  data.estatus_operacional_por_branch[key][
                    "Mantenimiento Mayor"
                  ] || 0,
                noperable:
                  data.estatus_operacional_por_branch[key]["No Operable"] || 0,
                rentready:
                  data.estatus_operacional_por_branch[key]["Rent Ready"] || 0,
                sinetapa:
                  data.estatus_operacional_por_branch[key]["Sin etapa"] || 0,
              }));
            console.log("barData", barData);

            propietarioData = Object.keys(data.utilizacion_por_propietario)
              .filter((key) => !["total"].includes(key))
              .map((key) => ({
                propietario: data.utilizacion_por_propietario[key].propietario,
                utiliz: Math.trunc(
                  data.utilizacion_por_propietario[key].utiliz
                ),
              }));
            console.log("propietarioData", propietarioData);

            const categoryData = Object.keys(data.utilizacion_por_categoria)
              .filter(
                (key) =>
                  !["total"].includes(key) && // Excluir la clave "total"
                  data.utilizacion_por_categoria[key].categoria !==
                    "AUTOMATIZACION DE SOLDADURA" // Excluir la categoría específica
              )
              .map((key) => ({
                categoria: data.utilizacion_por_categoria[key].categoria,
                utiliz: Math.trunc(data.utilizacion_por_categoria[key].utiliz),
              }));

            console.log(categoryData);
            console.log("propietarioData", categoryData);

            apiData = data;
            console.log("apiData", apiData);

            const donutData = [
              {
                category: "On Rent", // Categoría para on_rent
                value: apiData.utilizacion_por_sucursal.total.on_rent, // Valor correspondiente
              },
              {
                category: "Off Rent", // Categoría para off_rent
                value: apiData.utilizacion_por_sucursal.total.off_rent, // Valor correspondiente
              },
            ];

            // Mostramos los resultados

            console.log("donutData", donutData);

            const abrevi = {
              ccu: "CCUs",
              power: "Power Solutions",
            };

            ActivosPorLineaData = Object.keys(data.activos_por_linea)
              .filter((key) => key !== "total") // Excluye "total"
              .map((key) => ({
                categoria: abrevi[key] || key, // Usar abreviación si existe, de lo contrario mantener el nombre original
                valor: Math.trunc(data.activos_por_linea[key].porcentaje), // Accede al porcentaje de cada subobjeto
              }));
            console.log("ActivosPorLineaData", ActivosPorLineaData);

            totalData = Object.keys(data.utilizacion_por_sucursal)
              .filter((key) => key !== "total") // Excluye "total"
              .map((key) => ({
                sucursal: data.utilizacion_por_sucursal[key].sucursal,
                utiliz: Math.trunc(data.utilizacion_por_sucursal[key].total), // Accede al porcentaje de cada subobjeto
              }));
            console.log("totaData direct API", totalData);

            utilizacionData = Object.keys(data.utilizacion_por_sucursal)
              .filter((key) => key !== "total") // Excluye "total"
              .map((key) => ({
                sucursal: data.utilizacion_por_sucursal[key].sucursal,
                utiliz: Math.trunc(data.utilizacion_por_sucursal[key].utiliz), // Accede al porcentaje de cada subobjeto
              }));

            setData(
              pieChartData,
              ActivosPorLineaData,
              donutData,
              totalData,
              utilizacionData,
              barData,
              propietarioData,
              categoryData
            );
            updateCards(data);
          })
          .catch((error) =>
            console.error("Error al obtener datos de /api/data:", error)
          );
      };

      // Lógica de eventos para actualizar ambas APIs
      const handleDropdownChange = () => {
        const lineaProducto =
          document.getElementById("lineas").value !== "lineas"
            ? document.getElementById("lineas").value
            : "";
        const sucursalId =
          document.getElementById("sucursales").value !== "sucursales"
            ? document.getElementById("sucursales").value
            : "";
        const categoriaId =
          document.getElementById("categorias").value !== "categorias"
            ? document.getElementById("categorias").value
            : "";

        fetchFilteredData(lineaProducto, sucursalId, categoriaId);
      };

      // Configuración inicial
      document.addEventListener("DOMContentLoaded", () => {
        document
          .getElementById("lineas")
          .addEventListener("change", handleDropdownChange);
        document
          .getElementById("sucursales")
          .addEventListener("change", handleDropdownChange);
        document
          .getElementById("categorias")
          .addEventListener("change", handleDropdownChange);

        fetchFilteredData();
      });

      // Fetch para obtener las categorías desde la API y llenar el dropdown

      fetch("https://maintenancechart.onrender.com/api/data")
        .then((response) => {
          if (!response.ok) {
            throw new Error(`Error en la solicitud: ${response.status}`);
          }
          return response.json();
        })
        .then((data) => {
          const categorias = data.data_filtro.categorias;
          const sucursales = data.data_filtro.sucursales;
          const lineas = data.data_filtro.linea_productos;

          const categoriasPermitidas = [
            "SOLDADORAS ELECTRICAS",
            "MUD SKIP",
            "SOLDADORAS A COMBUSTION",
            "GENERADORES",
            "TORRES DE ILUMINACION",
            "CLOSED TOP",
            "ALIMENTADORES",
            "BASKET",
            "AUTOMATIZACION DE SOLDADURA",
            "COMPRESORES",
            "TABLEROS DE DISTRIBUCIÓN Y TRANSFERENCIA",
            "TANKS",
            "OPEN TOP",
            "HALF HEIGHT",
            "TOTES Y CARGO (R)",
            "SPOOLING UNIT",
            "RACK",
            "WASTE",
            "PMT POSICIONADORES, MANIPULADORES Y RODILLOS",
            "Non Core Equipment",
            "Chemical Container",
            "Todos",
            "EQUIPO DE IZAJE SLINGAS",
            "LIDDED CARGO BASKET",
            "CORTE Y PLASMA",
            "Welder",
            "EXTRACTORES DE HUMO",
            "Maquinaria en Renta",
          ];

          console.log("Lineas:", lineas);

          // Seleccionar los dropdowns por su ID
          const categoriaDropdown = document.getElementById("categorias");
          const sucursalDropdown = document.getElementById("sucursales");
          const lineaDropdown = document.getElementById("lineas");

          // Llenar el dropdown de categorías
          categorias
            .filter((categoria) =>
              categoriasPermitidas.includes(categoria.name)
            )
            .forEach((categoria) => {
              const option = document.createElement("option");
              option.value = categoria.id;
              option.textContent = categoria.name;
              categoriaDropdown.appendChild(option);
            });
          $("#categorias").selectpicker("refresh");
          // Llenar el dropdown de sucursales
          sucursales.forEach((sucursal) => {
            const option = document.createElement("option");
            option.value = sucursal.id;
            option.textContent = sucursal.name;
            sucursalDropdown.appendChild(option);
          });
          $("#sucursales").selectpicker("refresh");
          // Llenar el dropdown de líneas de productos
          Object.entries(lineas).forEach(([key, value]) => {
            const option = document.createElement("option");
            option.value = key; // Usar la clave como valor
            option.textContent = value; // Mostrar el valor como texto
            lineaDropdown.appendChild(option);
          });
          $("#lineas").selectpicker("refresh");
        })

        .catch((error) => {
          console.error("Error:", error);
        });

      // Inicialización de AmCharts

      am5.ready(function () {
        // Crear gráfico de pastel
        var chart10 = root.container.children.push(
          am5percent.PieChart.new(root, {
            endAngle: 270,
          })
        );

        // Crear serie
        series11 = chart10.series.push(
          am5percent.PieSeries.new(root, {
            valueField: "valor",
            categoryField: "categoria",
            endAngle: 270,
          })
        );
        // Ocultar las etiquetas
        series11.labels.template.set("visible", false);

        // Ocultar líneas de etiquetas
        series11.ticks.template.set("visible", false);

        series11.states.create("hidden", {
          endAngle: -90,
        });
        legend10 = chart10.children.push(
          am5.Legend.new(root, {
            centerX: am5.percent(50),
            x: am5.percent(50),
            marginTop: 15,
            marginBottom: 15,
          })
        );

        legend10.data.setAll(series11.dataItems);

        // Crear la segunda gráfica de pastel (Donut Chart)
        var chart0 = root6.container.children.push(
          am5percent.PieChart.new(root6, {
            layout: root6.verticalLayout,
            innerRadius: am5.percent(50),
          })
        );

        series0 = chart0.series.push(
          am5percent.PieSeries.new(root6, {
            valueField: "value",
            categoryField: "country",
            alignLabels: false,
          })
        );
        series0.labels.template.set("visible", false);

        series0.labels.template.setAll({
          textType: "circular",
          centerX: 0,
          centerY: 0,
        });

        // Crear leyenda para la segunda gráfica
        legend0 = chart0.children.push(
          am5.Legend.new(root6, {
            centerX: am5.percent(50),
            x: am5.percent(50),
            centerY: am5.percent(70), // Posición central en la parte superior izquierda
            y: am5.percent(5), // Posición central en la parte superior derecha
            marginTop: 0,
            marginBottom: 0,
          })
        );

        legend0.data.setAll(series0.dataItems);
        // Gráfica 1
        chart1 = root1.container.children.push(
          am5xy.XYChart.new(root1, {
            panX: true,
            panY: true,
            wheelX: "panX",
            wheelY: "zoomX",
            pinchZoomX: true,
          })
        );
        var cursor1 = chart1.set("cursor", am5xy.XYCursor.new(root1, {}));
        cursor1.lineY.set("visible", false);

        var xRenderer1 = am5xy.AxisRendererX.new(root1, {
          minGridDistance: 20,
        });
        xRenderer1.labels.template.setAll({
          rotation: -45,
          centerY: am5.p50,
          centerX: am5.p100,
          paddingRight: 15,
          fontSize: "10px",
        });

        xAxis1 = chart1.xAxes.push(
          am5xy.CategoryAxis.new(root1, {
            categoryField: "sucursal",
            renderer: xRenderer1,
            tooltip: am5.Tooltip.new(root1, {}),
          })
        );

        var yAxis1 = chart1.yAxes.push(
          am5xy.ValueAxis.new(root1, {
            renderer: am5xy.AxisRendererY.new(root1, { strokeOpacity: 0.1 }),
            numberFormat: "#",
          })
        );

        series1 = chart1.series.push(
          am5xy.ColumnSeries.new(root1, {
            name: "Series 1",
            xAxis: xAxis1,
            yAxis: yAxis1,
            valueYField: "utiliz",
            categoryXField: "sucursal",
            tooltip: am5.Tooltip.new(root1, { labelText: "{valueY}" }),
          })
        );

        // Add labels with the tooltip-like content fixed at the top of each bar
        series1.bullets.push(function () {
          return am5.Bullet.new(root1, {
            locationY: 1, // Location at the top of the bar
            sprite: am5.Label.new(root1, {
              text: "{valueY}",
              fill: am5.color(0x000000), // Color of the label (black)
              centerY: am5.p100,
              centerX: am5.p50,
              populateText: true,
              dy: -1, // Slightly above the bar
              fontSize: "10px",
            }),
          });
        });

        // Agregar estilos personalizados a las columnas de la primera gráfica
        series1.columns.template.setAll({
          cornerRadiusTL: 5, // Radio de esquina en la parte superior izquierda
          cornerRadiusTR: 5, // Radio de esquina en la parte superior derecha
          strokeOpacity: 0, // Sin opacidad para el borde
        });

        // Adaptador para cambiar el color de relleno dinámicamente
        series1.columns.template.adapters.add("fill", function (fill, target) {
          return chart1.get("colors").getIndex(series1.columns.indexOf(target)); // Obtener el color correspondiente al índice
        });
        // Gráfica 2
        var chart2 = root2.container.children.push(
          am5xy.XYChart.new(root2, {
            panX: true,
            panY: true,
            wheelX: "panX",
            wheelY: "zoomX",
            pinchZoomX: true,
          })
        );
        var cursor2 = chart2.set("cursor", am5xy.XYCursor.new(root2, {}));
        cursor2.lineY.set("visible", false);

        var xRenderer2 = am5xy.AxisRendererX.new(root2, {
          minGridDistance: 20,
        });
        xRenderer2.labels.template.setAll({
          rotation: -45,
          centerY: am5.p50,
          centerX: am5.p100,
          paddingRight: 15,
          fontSize: "10px",
        });
        xAxis2 = chart2.xAxes.push(
          am5xy.CategoryAxis.new(root2, {
            categoryField: "sucursal",
            renderer: xRenderer2,
            tooltip: am5.Tooltip.new(root2, {}),
          })
        );
        var yAxis2 = chart2.yAxes.push(
          am5xy.ValueAxis.new(root2, {
            renderer: am5xy.AxisRendererY.new(root2, { strokeOpacity: 0.1 }),
            numberFormat: "#'%'",
          })
        );
        series2 = chart2.series.push(
          am5xy.ColumnSeries.new(root2, {
            name: "Series 2",
            xAxis: xAxis2,
            yAxis: yAxis2,
            valueYField: "utiliz",
            categoryXField: "sucursal",
            tooltip: am5.Tooltip.new(root2, { labelText: "{valueY}%" }),
          })
        );
        series2.bullets.push(function () {
          return am5.Bullet.new(root2, {
            locationY: 1, // Location at the top of the bar
            sprite: am5.Label.new(root2, {
              text: "{valueY}%",
              fill: am5.color(0x2e4053), // Color of the label (black)
              centerY: am5.p100,
              centerX: am5.p50,
              populateText: true,
              dy: -1, // Slightly above the bar
              fontSize: "10px",
            }),
          });
        });

        // Agregar estilos personalizados a las columnas de la SEgunda gráfica
        series2.columns.template.setAll({
          cornerRadiusTL: 5, // Radio de esquina en la parte superior izquierda
          cornerRadiusTR: 5, // Radio de esquina en la parte superior derecha
          strokeOpacity: 0, // Sin opacidad para el borde
        });

        // Adaptador para cambiar el color de relleno dinámicamente
        series2.columns.template.adapters.add("fill", function (fill, target) {
          return chart2.get("colors").getIndex(series2.columns.indexOf(target)); // Obtener el color correspondiente al índice
        });
        // Gráfica 3
        chart3 = root3.container.children.push(
          am5xy.XYChart.new(root3, {
            panX: false,
            panY: false,
            wheelX: "panX",
            wheelY: "zoomX",
            layout: root3.verticalLayout,
          })
        );
        // Add scrollbar
        // https://www.amcharts.com/docs/v5/charts/xy-chart/scrollbars/
        chart3.set(
          "scrollbarX",
          am5.Scrollbar.new(root3, {
            orientation: "horizontal",
          })
        );
        var xRenderer3 = am5xy.AxisRendererX.new(root3, {
          minGridDistance: 20,
        });
        xRenderer3.labels.template.setAll({
          rotation: -45,
          centerY: am5.p50,
          centerX: am5.p100,
          paddingRight: 15,
          fontSize: "10px",
        });
        xAxis3 = chart3.xAxes.push(
          am5xy.CategoryAxis.new(root3, {
            categoryField: "sucursal",
            renderer: xRenderer3,
            tooltip: am5.Tooltip.new(root3, {}),
          })
        );
        const yAxis3 = chart3.yAxes.push(
          am5xy.ValueAxis.new(root3, {
            min: 0,
            renderer: am5xy.AxisRendererY.new(root3, { strokeOpacity: 0.1 }),
          })
        );
        var legend3 = chart3.children.push(
          am5.Legend.new(root3, { centerX: am5.p50, x: am5.p50 })
        );
        // Personalización de la leyenda 4
        legend3.labels.template.setAll({
          fontSize: "10px", // Reduce el tamaño de las etiquetas
          fill: am5.color(0x555555), // Cambia el color de las etiquetas (opcional)
        });
        // Leyenda para gráfico de barras
        chart3.children.push(
          am5.Legend.new(root3, { centerX: am5.p50, x: am5.p50 })
        );

        // Series para gráfico de barras staked2
        const makeSeries3 = (name, fieldName) => {
          const series = chart3.series.push(
            am5xy.ColumnSeries.new(root3, {
              name: name,
              stacked: true,
              xAxis: xAxis3,
              yAxis: yAxis3,
              valueYField: fieldName,
              categoryXField: "sucursal",
            })
          );
          series.columns.template.setAll({
            tooltipText: "{name}, {categoryX}: {valueY}",
          });
          series.bullets.push(function () {
            return am5.Bullet.new(root3, {
              sprite: am5.Label.new(root3, {
                text: "{valueY}",
                fill: root3.interfaceColors.get("alternativeText"),
                centerY: am5.p50,
                centerX: am5.p50,
                populateText: true,
                fontSize: "10px",
              }),
            });
          });
          legend3.data.push(series);
        };

        makeSeries3("Rent Ready", "rentready");
        makeSeries3("Mtto. Menor ", "major");
        makeSeries3("Mtto. Mayor", "minor");
        makeSeries3("No Operable", "noperable");
        makeSeries3("Sin Etapa", "sinetapa");

        // Gráfica 4 (nueva)
        var chart4 = root4.container.children.push(
          am5xy.XYChart.new(root4, {
            panX: true,
            panY: true,
            wheelX: "panX",
            wheelY: "zoomX",
            pinchZoomX: true,
          })
        );
        var cursor4 = chart4.set("cursor", am5xy.XYCursor.new(root4, {}));
        cursor4.lineY.set("visible", false);

        var xRenderer4 = am5xy.AxisRendererX.new(root4, {
          minGridDistance: 20,
        });
        xRenderer4.labels.template.setAll({
          rotation: -45,
          centerY: am5.p50,
          centerX: am5.p100,
          paddingRight: 15,
          fontSize: "10px",
        });
        xAxis4 = chart4.xAxes.push(
          am5xy.CategoryAxis.new(root4, {
            categoryField: "propietario",
            renderer: xRenderer4,
            tooltip: am5.Tooltip.new(root4, {}),
          })
        );

        var yAxis4 = chart4.yAxes.push(
          am5xy.ValueAxis.new(root4, {
            renderer: am5xy.AxisRendererY.new(root4, { strokeOpacity: 0.1 }),
            numberFormat: "#'%'",
          })
        );
        series4 = chart4.series.push(
          am5xy.ColumnSeries.new(root4, {
            name: "Series 4",
            xAxis: xAxis4,
            yAxis: yAxis4,
            valueYField: "utiliz",
            categoryXField: "propietario",
            tooltip: am5.Tooltip.new(root4, { labelText: "{valueY}%" }),
          })
        );
        series4.bullets.push(function () {
          return am5.Bullet.new(root4, {
            locationY: 1, // Location at the top of the bar
            sprite: am5.Label.new(root4, {
              text: "{valueY}%",
              fill: am5.color(0x000000), // Color of the label (black)
              centerY: am5.p100,
              centerX: am5.p50,
              populateText: true,
              dy: -1, // Slightly above the bar
              fontSize: "10px",
            }),
          });
        });

        // Agregar estilos personalizados a las columnas de la SEgunda gráfica
        series4.columns.template.setAll({
          cornerRadiusTL: 5, // Radio de esquina en la parte superior izquierda
          cornerRadiusTR: 5, // Radio de esquina en la parte superior derecha
          strokeOpacity: 0, // Sin opacidad para el borde
        });

        // Adaptador para cambiar el color de relleno dinámicamente
        series4.columns.template.adapters.add("fill", function (fill, target) {
          return chart4.get("colors").getIndex(series4.columns.indexOf(target)); // Obtener el color correspondiente al índice
        });

        // Gráfica 5
        var chart5 = root5.container.children.push(
          am5xy.XYChart.new(root5, {
            panX: true,
            panY: true,
            wheelX: "panX",
            wheelY: "zoomX",
            pinchZoomX: true,
          })
        );
        var cursor5 = chart5.set("cursor", am5xy.XYCursor.new(root5, {}));
        cursor5.lineY.set("visible", false);

        var xRenderer5 = am5xy.AxisRendererX.new(root5, {
          minGridDistance: 20,
        });
        xRenderer5.labels.template.setAll({
          rotation: -45,
          centerY: am5.p50,
          centerX: am5.p100,
          paddingRight: 15,
          fontSize: "10px",
        });
        xAxis5 = chart5.xAxes.push(
          am5xy.CategoryAxis.new(root5, {
            categoryField: "categoria",
            renderer: xRenderer5,
            tooltip: am5.Tooltip.new(root5, {}),
          })
        );
        var yAxis5 = chart5.yAxes.push(
          am5xy.ValueAxis.new(root5, {
            renderer: am5xy.AxisRendererY.new(root5, { strokeOpacity: 0.1 }),
            numberFormat: "#'%'",
          })
        );

        series5 = chart5.series.push(
          am5xy.ColumnSeries.new(root5, {
            name: "Series 5",
            xAxis: xAxis5,
            yAxis: yAxis5,
            valueYField: "utiliz",
            categoryXField: "categoria",
            tooltip: am5.Tooltip.new(root5, { labelText: "{valueY}%" }),
          })
        );
        series5.bullets.push(function () {
          return am5.Bullet.new(root5, {
            locationY: 1, // Location at the top of the bar
            sprite: am5.Label.new(root5, {
              text: "{valueY}%",
              fill: am5.color(0x2e4053), // Color of the label (black)
              centerY: am5.p100,
              centerX: am5.p50,
              populateText: true,
              dy: -1, // Slightly above the bar
              fontSize: "10px",
            }),
          });
        });

        // Agregar estilos personalizados a las columnas de la primera gráfica
        series5.columns.template.setAll({
          cornerRadiusTL: 5, // Radio de esquina en la parte superior izquierda
          cornerRadiusTR: 5, // Radio de esquina en la parte superior derecha
          strokeOpacity: 0, // Sin opacidad para el borde
        });

        // Adaptador para cambiar el color de relleno dinámicamente
        series5.columns.template.adapters.add("fill", function (fill, target) {
          return chart5.get("colors").getIndex(series5.columns.indexOf(target)); // Obtener el color correspondiente al índice
        });
        // Establecer los datos iniciales
        setData(
          pieChartData,
          ActivosPorLineaData,
          donutData,
          totalData,
          utilizacionData,
          barData,
          propietarioData,
          categoryData
        );

        // Actualizar leyendas
        legend10.data.setAll(series11.dataItems);
        legend0.data.setAll(series0.dataItems);
      });
    </script>
  </body>
</html>
